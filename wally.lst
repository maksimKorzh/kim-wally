;-----------------------------------------------------------------------;
;  Program:     Wally                                                   ;
;  Author:      Code monkey King                                        ;
;  Date:        2024-08-14                                              ;
;  System:      Unexpanded KIM-1                                        ;
;-----------------------------------------------------------------------;
;  Description:                                                         ;
;  This listing is a reconstruction of the original game of Go playing  ;
;  program written by Jonathan K. Millen for the unexpanded KIM-1. The  ;
;  code has been carefully assembled by hand to preserve the original   ;
;  functionality on the same platform.                                  ;
;-----------------------------------------------------------------------;

;-----------------------------------------------------------------------;
;                 BOARD REPRESENTATION & PIECE ENCODING                 ;
;                       ($0000-$00FF), 256 bytes                        ;
;-----------------------------------------------------------------------;
;                                                                       ;
;    30  31  32  32  34  35  36  37  38  39  41  42  43  44  45  46     ;
;    31  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    32  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    33  2E  2E  58  2E  2E  2E  2E  2E  2E  2E  2E  2E  4F  2E  2E     ;
;    34  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    35  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    36  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    37  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    38  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    39  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    41  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    42  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    43  2E  2E  58  2E  2E  2E  2E  2E  2E  2E  2E  2E  4F  2E  2E     ;
;    44  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    45  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;    46  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E  2E     ;
;                                                                       ;
;-----------------------------------------------------------------------;
;       EMPTY = '.'; BLACK = 'X'; WHITE = 'O'; MARKER = 6TH BIT;        ;
;-----------------------------------------------------------------------;

;-----------------------------------------------------------------------;
;                            PROGRAM LISTING                            ;
;-----------------------------------------------------------------------;
  PRNBRD:  0200  18        CLC                     ;                    ;
           0201  A2 00     LDX #$00                ;                    ;
  PRLOOP:  0203  8A        TXA                     ;                    ;
           0204  29 0F     AND #$0F                ;                    ;
           0206  F0 0D     BEQ NEWLIN              ;                    ;
  PRNCHR:  0208  B5 00     LDA BOARD,X             ;                    ;
           020A  20 A0 1E  JSR $OUTCH              ;                    ;
           020D  20 9E 1E  JSR $OUTSP              ;                    ;
           0210  E8        INX                     ;    Print board     ;
           0211  D0 F0     BNE PRLOOP              ;   ($0200-$021E)    ;
           0213  F0 09     BEQ PRNRET              ;      31 bytes      ;
  NEWLIN:  0215  8A        TXA                     ;                    ;
           0216  48        PHA                     ;                    ;
           0217  20 2F 1E  JSR CRLF                ;                    ;
           021A  68        PLA                     ;                    ;
           021B  AA        TAX                     ;                    ;
           021C  90 EA     BCC PRNCHR              ;                    ;
  PRNRET:  021E  60        RTS                     ;                    ;
;-----------------------------------------------------------------------;
  CLRBRD:  021F  A2 00     LDX #$00                ;                    ;
           0221  A9 2E     LDA #$2E                ;    Clear board     ;
  CLEARL:  0223  95 00     STA BOARD,X             ;   ($021F-$0228)    ;
           0225  E8        INX                     ;      10 bytes      ;
           0226  D0 FB     BNE CLEARL              ;                    ;
           0228  60        RTS                     ;                    ;
;-----------------------------------------------------------------------;
  COORDS:  0229  30 31 32  .BYTE '0', '1', '2'     ;                    ;
           022C  33 34 35  .BYTE '3', '4', '5'     ;    Coordinates     ;
           022F  36 37 38  .BYTE '6', '7', '8'     ;   ($0229-$0238)    ;
           0232  39 41 42  .BYTE '9', 'A', 'B'     ;      16 bytes      ;
           0235  43 44 45  .BYTE 'C', 'D', 'E'     ;                    ;
           0238  46        .BYTE 'F'               ;                    ;
;-----------------------------------------------------------------------;
  PCOORD:  0239  A2 00     LDX #$00                ;                    ;
  COLLOP:  023B  BD 29 02  LDA COORDS,X            ;                    ;
           023E  95 00     STA BOARD,X             ;                    ;
           0240  E8        INX                     ;                    ;
           0241  E0 10     CPX #$10                ;                    ;
           0243  D0 F6     BNE COLLOP              ;                    ;
           0245  A0 00     LDY #$00                ;                    ;
           0247  A2 00     LDX #$00                ;    Print coords    ;
  ROWLOP:  0249  B9 29 02  LDA COORDS,Y            ;    ($0239-$0258)   ;
           024C  95 00     STA BOARD,X             ;      32 bytes      ;
           024E  8A        TXA                     ;                    ;
           024F  18        CLC                     ;                    ;
           0250  69 10     ADC #$10                ;                    ;
           0252  AA        TAX                     ;                    ;
           0253  C8        INY                     ;                    ;
           0254  C0 10     CPY #$10                ;                    ;
           0256  D0 F1     BNE ROWLOP              ;                    ;
           0258  60        RTS                     ;                    ;
;-----------------------------------------------------------------------;
  USRMOV:  0259  00        .BYTE 0                 ;  User move ($0259) ;
;-----------------------------------------------------------------------;
  USRINP:  025A  18        CLC                     ;                    ;
  KEYDN1:  025B  20 6A 1F  JSR GETKEY              ;                    ;
           025E  C9 10     CMP #$10                ;                    ;
           0260  B0 F9     BCS KEYDN1              ;                    ;
           0262  0A        ASL                     ;                    ;
           0263  0A        ASL                     ;                    ;
           0264  0A        ASL                     ;                    ;
           0265  0A        ASL                     ;                    ;
           0266  8D 59 02  STA USRMOV              ;                    ;
  KEYUP1:  0269  20 6A 1F  JSR GETKEY              ;      Set stone     ;
           026C  C9 15     CMP #$15                ;    ($025A-$0285)   ;
           026E  D0 F9     BNE KEYUP1              ;      44 bytes      ;
  KEYDN2:  0270  18        CLC                     ;                    ;
           0271  20 6A 1F  JSR GETKEY              ;                    ;
           0274  C9 10     CMP #$10                ;                    ;
           0276  B0 F9     BCS KEYDN2              ;                    ;
           0278  0D 59 02  ORA USRMOV              ;                    ;
           027B  8D 59 02  STA USRMOV              ;                    ;
           027E  AE 59 02  LDX USRMOV              ;                    ;
           0281  A9 4F     LDA #$4F                ;                    ;
           0283  95 00     STA BOARD,X             ;                    ;
           0285  60        RTS                     ;                    ;
;-----------------------------------------------------------------------;
  CCOLOR:  0286  00        .BYTE 0                 ;                    ;
;-----------------------------------------------------------------------;
  COUNTL:  0287  A0 00     LDY #$00                ;                    ;
  COUNTR:  0289  18        CLC                     ;                    ;
           028A  E0 10     CPX #$10                ;                    ;
           028C  90 40     BCC CNTRET              ;                    ;
           028E  8A        TXA                     ;                    ;
           028F  29 0F     AND #$0F                ;                    ;
           0291  F0 3B     BEQ CNTRET              ;                    ;
 ;-------------------------------------------------;                    ;
           0293  B5 00     LDA BOARD,X             ;                    ;
           0295  C9 2E     CMP #$2E                ;                    ;
           0297  F0 30     BEQ MARKLB              ;                    ;
           0299  CD 86 02  CMP CCOLOR              ;                    ;
           029C  D0 30     BNE CNTRET              ;                    ;
           029E  29 20     AND #$20                ;                    ;
           02A0  D0 2C     BNE CNTRET              ;                    ;
 ;-------------------------------------------------;                    ;
           02A2  B5 00     LDA BOARD,X             ;                    ;
           02A4  09 20     ORA #$20                ;                    ;
           02A6  95 00     STA BOARD,X             ;                    ;
           02A8  E8        INX                     ;                    ;
           02A9  20 89 02  JSR COUNTR              ;                    ;
           02AC  CA        DEX                     ;  Count liberties   ;
           02AD  CA        DEX                     ;   ($0287-$02CE)    ;
           02AE  20 89 02  JSR COUNTR              ;     72 bytes       ;
           02B1  8A        TXA                     ;                    ;
           02B2  18        CLC                     ;                    ;
           02B3  E9 0E     SBC #$0E                ;                    ;
           02B5  AA        TAX                     ;                    ;
           02B6  20 89 02  JSR COUNTR              ;                    ;
           02B9  8A        TXA                     ;                    ;
           02BA  18        CLC                     ;                    ;
           02BB  69 20     ADC #$20                ;                    ;
           02BD  AA        TAX                     ;                    ;
           02BE  20 89 02  JSR COUNTR              ;                    ;
           02C1  8A        TXA                     ;                    ;
           02C2  18        CLC                     ;                    ;
           02C3  E9 0F     SBC #$0F                ;                    ;
           02C5  AA        TAX                     ;                    ;
           02C6  18        CLC                     ;                    ;
           02C7  90 05     BCC CNTRET              ;                    ;
;--------------------------------------------------;                    ;
  MARKLB:  02C9  A9 2B     LDA #$2B                ;                    ;
           02CB  95 00     STA BOARD,X             ;                    ;
           02CD  C8        INY                     ;                    ;
;--------------------------------------------------;                    ;
  CNTRET:  02CE  60        RTS                     ;                    ;
;-----------------------------------------------------------------------;
  WEFECT:  02CF  A9 58     LDA #BLACK              ;                    ;
                 8D 86 02  STA CCOLOR              ;                    ;
                 A2 00     LDX #$00                ;                    ;
  WCNTLP:        20 87 02  JSR COUNTL              ;                    ;
                 C0 00     CPY #$00                ;                    ;
                 D0 FF(0A) BNE WENEXT              ;                    ;
  CGROUP:  02DD  B5 00     LDA BOARD,X             ;                    ;
                 C9 78     CMP #$78                ;                    ;
                 D0 FF(04) BNE WNEXT               ;                    ;
                 A9 2E     LDA #EMPTY              ;                    ;
                 95 00     STA BOARD,X             ;                    ;
  WENEXT:        E8        INX                     ;                    ;
                 D0 FF(EC) BNE WCNTLP              ;                    ;
  WEFRET:        60        RTS                     ;                    ;
;-----------------------------------------------------------------------;



;-----------------------------------------------------------------------;
  PROGST:  XXXX  D8        CLD                     ;   Program start    ;
           XXXX  20 1F 02  JSR CLRBRD              ;   ($XXXX-$XXXX)    ;
           XXXX  20 39 02  JSR PCOORD              ;      7 bytes       ;
;--------------------------------------------------;                    ;
           XXXX  A9 58     LDA #BLACK
           XXXX  85 22
           XXXX  85 23
           XXXX  85 24
;-----------------------------------------------------------------------;
  PROGLP:  XXXX  20 00 02  JSR PRNBRD              ;     Main loop      ;
           XXXX  20 5A 02  JSR USRINP              ;   ($XXXX-$XXXX)    ;
           XXXX  20 CF 02  JSR WEFECT              ;                    ;
           XXXX  4C XX XX  JMP PROGLP              ;     XX bytes       ;
;-----------------------------------------------------------------------;











